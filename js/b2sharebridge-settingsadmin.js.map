{"version":3,"file":"b2sharebridge-settingsadmin.js?v=a97736ad07eda9d3d38f","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///b2sharebridge/src/settings-admin.js"],"sourcesContent":["$(document).ready(function () {\n  var baseUrl = OC.generateUrl('/apps/b2sharebridge/servers');\n  $('#maxB2shareUploads').change(function () {\n    OC.AppConfig.setValue('b2sharebridge', $(this).attr('name'), $(this).val());\n  });\n  $('#maxB2shareUploadFilesize').change(function () {\n    OC.AppConfig.setValue('b2sharebridge', $(this).attr('name'), $(this).val());\n  });\n  $('#checkSsl').change(function () {\n    var value = '0';\n    if (this.checked) {\n      value = '1';\n    }\n    OC.AppConfig.setValue('b2sharebridge', $(this).attr('name'), value);\n  });\n  function saveChanges() {\n    var names = $('[id^=\"name\"]');\n    var publishUrls = $('[id^=\"url\"]');\n    var regex = /(http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/i;\n    var data = [];\n    for (i = 0; i < names.length; i++) {\n      var publishUrl = publishUrls[i].value;\n      data.push({\n        name: names[i].value,\n        publishUrl\n      });\n      id = names[i].id.split(\"_\")[1];\n      if (id && id.length) {\n        data[i].id = id;\n      }\n      if (!regex.exec(publishUrl)) {\n        OC.msg.finishedSaving('#saving .msg', {\n          'status': 'failure',\n          'data': {\n            'message': `Invalid URL: ${publishUrl}`\n          }\n        });\n        return;\n      }\n    }\n    OC.msg.startSaving('#saving .msg', 'Saving servers...');\n    $.ajax({\n      url: baseUrl,\n      type: 'POST',\n      contentType: 'application/json',\n      data: JSON.stringify({\n        servers: data\n      })\n    }).done(function (response) {\n      if (response.length) {\n        const id = response[response.length - 1].id;\n        $('#b2share_server').prop('id', 'b2share_server_' + id);\n        ['url', 'name', 'delete'].forEach(function (s) {\n          $('#' + s).prop('id', s + '_' + id);\n        });\n        $('#add-server').show();\n      }\n      OC.msg.finishedSaving('#saving .msg', {\n        'status': 'success',\n        'data': {\n          'message': 'Saved'\n        }\n      });\n    }).fail(function (response) {\n      OC.msg.finishedSaving('#saving .msg', {\n        'status': 'failure',\n        'data': {\n          'message': 'Saving failed!'\n        }\n      });\n    });\n  }\n  function deleteServer(event) {\n    const id = event.target.id.split('_')[1];\n    if (id) {\n      if (!window.confirm(\"Are you sure you want to delete the server? This action is irreversible.\")) {\n        return;\n      }\n      OC.msg.startSaving('#saving .msg', 'Deleting...');\n      $.ajax({\n        url: baseUrl + '/' + id,\n        type: 'DELETE'\n      }).done(function (response) {\n        $('#b2share_server_' + id).remove();\n        OC.msg.finishedSaving('#saving .msg', {\n          'status': 'success',\n          'data': {\n            'message': 'Server deleted'\n          }\n        });\n      }).fail(function (response) {\n        OC.msg.finishedSaving('#saving .msg', {\n          'status': 'failure',\n          'data': {\n            'message': 'Deleting failed!'\n          }\n        });\n      });\n    } else {\n      // no id == server has not been saved yet\n      $('#b2share_server').remove();\n      $('#add-server').show();\n    }\n  }\n  $('#send').click(function () {\n    saveChanges();\n  });\n  $(\"[id^='#delete_']\").click(deleteServer);\n  $('#add-server').click(function () {\n    $('#add-server').before('<div id=\"b2share_server\"><p id=\"b2shareUrlField\">\\\n                <input title=\"publish_baseurl\" type=\"text\" name=\"publish_baseurl\"\\\n                id=\"url\" placeholder=\"https://b2share.eudat.eu\" style=\"width: 400px\"/>\\\n                   <em>Publish URL</em></p>\\\n                <p id=\"b2shareNameField>\">\\\n                <input title=\"name\" type=\"text\" name=\"name\"\\\n                id=\"name\"\\\n                style=\"width: 400px\"/>\\\n                <em>Server name</em></p>\\\n                <button id=\"delete\">Delete server</button></div>');\n    $('#add-server').hide();\n    $('#delete').click(deleteServer);\n  });\n});"],"names":[],"sourceRoot":""}