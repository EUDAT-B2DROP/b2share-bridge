(()=>{"use strict";var e,s={9442:(e,s,a)=>{var r=a(144),l=a(6256),i=a(8483),o=a(9652),d=a(9753);const u={name:"ServerEditor",model:{event:"server-change"},props:{id:{default:null,type:Number},name:{required:!1,type:String},publishurl:{required:!1,type:String},maxuploads:{default:5,type:Number},maxuploadfilesize:{default:512,type:Number},checkssl:{default:!1,type:Boolean}},data(){return{mutable_name:this.name,mutable_publishUrl:this.publishurl,mutable_maxUploads:this.maxuploads,mutable_maxUploadFilesize:this.maxuploadfilesize,mutable_checkSsl:this.checkssl}},computed:{getCheckboxName(){return"checkSsl"+(null===this.id?"":this.id)}},methods:{resetProps(){this.mutable_name=null,this.mutable_publishUrl=null,this.mutable_maxUploads=5,this.mutable_maxUploadFilesize=512,this.mutable_checkSsl=!1},hasChanged(){return this.mutable_name!==this.name||this.mutable_publishUrl!==this.publishurl||this.mutable_maxUploads!==this.maxuploads||this.mutable_maxUploadFilesize!==this.maxuploadfilesize||this.mutable_checkSsl!==this.checkssl},saveServer(){const t={};this.id&&(t.id=this.id),t.name=this.mutable_name,t.publishUrl=this.stripTrailingSlash(this.mutable_publishUrl),this.mutable_publishUrl=t.publishUrl,t.maxUploads=this.mutable_maxUploads,t.maxUploadFilesize=this.mutable_maxUploadFilesize,t.checkSsl=this.mutable_checkSsl,console.debug(JSON.stringify(t)),o.Z.post((0,d.generateUrl)("/apps/b2sharebridge/server"),{server:t}).then((t=>{this.$emit("server-change",null===this.id?0:this.id)})).catch((t=>{console.error("Could not save server"),console.debug(t)}))},deleteServer(){this.id&&o.Z.delete((0,d.generateUrl)("/apps/b2sharebridge/servers/"+this.id)).then((t=>{console.log("Deleted server '"+this.name+"'"),this.$emit("server-change",this.id)})).catch((t=>{console.error("Could not delete server"),console.debug(t)}))},stripTrailingSlash:t=>t.endsWith("/")?t.slice(0,-1):t}};var m=a(3379),p=a.n(m),h=a(7795),c=a.n(h),v=a(569),b=a.n(v),_=a(3565),x=a.n(_),g=a(9216),f=a.n(g),S=a(4589),A=a.n(S),U=a(7766),k={};k.styleTagTransform=A(),k.setAttributes=x(),k.insert=b().bind(null,"head"),k.domAPI=c(),k.insertStyleElement=f(),p()(U.Z,k),U.Z&&U.Z.locals&&U.Z.locals;var y=a(1900);const C={name:"AdminSettings",components:{ServerEditor:(0,y.Z)(u,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"server_form"},[e("h4",[t._v(t._s(null==t.id?"New Server":t.mutable_name))]),t._v(" "),e("p",{attrs:{id:"maxB2shareUploadsPerUser"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mutable_maxUploads,expression:"mutable_maxUploads"}],staticStyle:{width:"400px"},attrs:{title:"max_uploads",type:"text",name:"max_uploads",placeholder:"5"},domProps:{value:t.mutable_maxUploads},on:{input:function(e){e.target.composing||(t.mutable_maxUploads=e.target.value)}}}),t._v(" "),e("em",[t._v("# of uploads per user at the same time")])]),t._v(" "),e("p",{attrs:{id:"maxB2shareUploadSizePerFile"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mutable_maxUploadFilesize,expression:"mutable_maxUploadFilesize"}],staticStyle:{width:"400px"},attrs:{title:"max_upload_filesize",type:"text",name:"max_upload_filesize",placeholder:"512"},domProps:{value:t.mutable_maxUploadFilesize},on:{input:function(e){e.target.composing||(t.mutable_maxUploadFilesize=e.target.value)}}}),t._v(" "),e("em",[t._v("MB maximum filesize per upload")])]),t._v(" "),e("p",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mutable_checkSsl,expression:"mutable_checkSsl"}],staticClass:"checkbox",staticStyle:{width:"400px"},attrs:{id:t.getCheckboxName,type:"checkbox",name:t.getCheckboxName},domProps:{checked:t.mutable_checkSsl,checked:Array.isArray(t.mutable_checkSsl)?t._i(t.mutable_checkSsl,null)>-1:t.mutable_checkSsl},on:{change:function(e){var n=t.mutable_checkSsl,s=e.target,a=!!s.checked;if(Array.isArray(n)){var r=t._i(n,null);s.checked?r<0&&(t.mutable_checkSsl=n.concat([null])):r>-1&&(t.mutable_checkSsl=n.slice(0,r).concat(n.slice(r+1)))}else t.mutable_checkSsl=a}}}),t._v(" "),e("label",{attrs:{for:t.getCheckboxName}},[t._v("Check SSL")])]),t._v(" "),e("p",{attrs:{id:"b2shareUrlField"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mutable_publishUrl,expression:"mutable_publishUrl"}],staticStyle:{width:"400px"},attrs:{title:"publishurl",type:"text",name:"publish_baseurl",placeholder:"https://b2share.eudat.eu"},domProps:{value:t.mutable_publishUrl},on:{input:function(e){e.target.composing||(t.mutable_publishUrl=e.target.value)}}}),t._v(" "),e("em",[t._v("Publish URL")])]),t._v(" "),e("p",{attrs:{id:"b2shareNameField"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mutable_name,expression:"mutable_name"}],staticStyle:{width:"400px"},attrs:{title:"name",type:"text",name:"name",placeholder:"Your Server Name"},domProps:{value:t.mutable_name},on:{input:function(e){e.target.composing||(t.mutable_name=e.target.value)}}}),t._v(" "),e("em",[t._v("Server name")])]),t._v(" "),e("button",{attrs:{id:"save",disabled:!t.hasChanged()},on:{click:t.saveServer}},[t._v("\n\t\tSave\n\t")]),t._v(" "),null!==t.id?e("button",{on:{click:t.deleteServer}},[t._v("\n\t\tDelete\n\t")]):t._e(),t._v(" "),null===t.id?e("button",{attrs:{id:"reset",disabled:!t.hasChanged()},on:{click:t.resetProps}},[t._v("\n\t\tReset\n\t")]):t._e()])}),[],!1,null,"8a436440",null).exports},data:()=>({dummy_server:{id:null,name:null,publishUrl:null,maxUploads:5,maxUploadFilesize:512,checkSsl:!1},servers:[],loaded:!1}),async mounted(){await this.loadServers(),this.loaded=!0},methods:{loadServers(){const t="/apps/b2sharebridge/servers?requesttoken="+encodeURIComponent(OC.requestToken);return o.Z.get((0,d.generateUrl)(t)).then((t=>{console.log("Loaded servers:"),console.debug(t),this.servers=[],this.servers=this.servers.concat(t.data)})).catch((t=>{console.error("Fetching B2SHARE servers failed!"),console.error(t)}))}}};var z=a(871),w={};w.styleTagTransform=A(),w.setAttributes=x(),w.insert=b().bind(null,"head"),w.domAPI=c(),w.insertStyleElement=f(),p()(z.Z,w),z.Z&&z.Z.locals&&z.Z.locals;const F=(0,y.Z)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"section",attrs:{id:"admin-settings"}},[e("h2",[t._v("EUDAT B2SHARE Bridge")]),t._v(" "),e("div",{staticClass:"new_server"},[e("h3",[t._v("Create a new Server:")]),t._v(" "),e("ServerEditor",{attrs:{id:t.dummy_server.id,name:t.dummy_server.name,publishurl:t.dummy_server.publishUrl,maxuploads:t.dummy_server.maxUploads,maxuploadfilesize:t.dummy_server.maxUploadFilesize,checkssl:t.dummy_server.checkSsl},on:{"server-change":t.loadServers}})],1),t._v(" "),t.loaded&&t.servers.length?e("div",{staticClass:"servers"},[e("h3",[t._v("Servers:")]),t._v(" "),e("ul",t._l(t.servers,(function(n){return e("li",[e("ServerEditor",{attrs:{id:parseInt(n.id),name:n.name,publishurl:n.publishUrl,maxuploads:n.maxUploads,maxuploadfilesize:n.maxUploadFilesize,checkssl:1===n.checkSsl},on:{"server-change":t.loadServers}})],1)})),0)]):t._e()])}),[],!1,null,"4aaadf86",null).exports;r.default.use(l.XG7),r.default.use(i.A7),r.default.extend(F),r.default.mixin({methods:{t,n}}),document.getElementById("admin-settings")&&new r.default({el:"#admin-settings",render:t=>t(F)})},871:(t,e,n)=>{n.d(e,{Z:()=>i});var s=n(7537),a=n.n(s),r=n(3645),l=n.n(r)()(a());l.push([t.id,"\ndiv.new_server[data-v-4aaadf86] {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\ndiv.servers[data-v-4aaadf86] {\n\tmargin-top: 10px;\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\n","",{version:3,sources:["webpack://./src/components/AdminSettings.vue"],names:[],mappings:";AAsFA;CACA,oCAAA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,gBAAA;CACA,oCAAA;CACA,aAAA;CACA,mBAAA;AACA",sourcesContent:['<template>\n\t<div id="admin-settings" class="section">\n\t\t<h2>EUDAT B2SHARE Bridge</h2>\n\t\t<div class="new_server">\n\t\t\t<h3>Create a new Server:</h3>\n\t\t\t<ServerEditor :id="dummy_server.id"\n\t\t\t\t:name="dummy_server.name"\n\t\t\t\t:publishurl="dummy_server.publishUrl"\n\t\t\t\t:maxuploads="dummy_server.maxUploads"\n\t\t\t\t:maxuploadfilesize="dummy_server.maxUploadFilesize"\n\t\t\t\t:checkssl="dummy_server.checkSsl"\n\t\t\t\t@server-change="loadServers" />\n\t\t</div>\n\t\t<div v-if="loaded && servers.length" class="servers">\n\t\t\t<h3>Servers:</h3>\n\t\t\t<ul>\n\t\t\t\t<li v-for="server in servers">\n\t\t\t\t\t<ServerEditor :id="parseInt(server.id)"\n\t\t\t\t\t\t:name="server.name"\n\t\t\t\t\t\t:publishurl="server.publishUrl"\n\t\t\t\t\t\t:maxuploads="server.maxUploads"\n\t\t\t\t\t\t:maxuploadfilesize="server.maxUploadFilesize"\n\t\t\t\t\t\t:checkssl="server.checkSsl === 1"\n\t\t\t\t\t\t@server-change="loadServers" />\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n// import {NcAppContent} from "@nextcloud/vue";\nimport axios from \'@nextcloud/axios\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport ServerEditor from \'./ServerEditor.vue\'\n\nexport default {\n\tname: \'AdminSettings\',\n\tcomponents: {\n\t\t// NcAppContent,\n\t\tServerEditor,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tdummy_server: {\n\t\t\t\tid: null,\n\t\t\t\tname: null,\n\t\t\t\tpublishUrl: null,\n\t\t\t\tmaxUploads: 5,\n\t\t\t\tmaxUploadFilesize: 512,\n\t\t\t\tcheckSsl: false,\n\t\t\t},\n\t\t\tservers: [],\n\t\t\tloaded: false,\n\t\t}\n\t},\n\n\t/**\n\t * Fetch list of servers when the component is loaded\n\t */\n\tasync mounted() {\n\t\tawait this.loadServers()\n\t\tthis.loaded = true\n\t},\n\tmethods: {\n\t\tloadServers() {\n\t\t\tconst url_path = \'/apps/b2sharebridge/servers?requesttoken=\' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(url_path))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.log(\'Loaded servers:\')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.servers = []\n\t\t\t\t\tthis.servers = this.servers.concat(response.data)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(\'Fetching B2SHARE servers failed!\')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\ndiv.new_server {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\n\ndiv.servers {\n\tmargin-top: 10px;\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\n</style>\n'],sourceRoot:""}]);const i=l},7766:(t,e,n)=>{n.d(e,{Z:()=>i});var s=n(7537),a=n.n(s),r=n(3645),l=n.n(r)()(a());l.push([t.id,"\ndiv.server_form[data-v-8a436440] {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tmargin-top: 2px;\n}\n","",{version:3,sources:["webpack://./src/components/ServerEditor.vue"],names:[],mappings:";AA8JA;CACA,oCAAA;CACA,aAAA;CACA,mBAAA;CACA,eAAA;AACA",sourcesContent:['<template>\n\t<div class="server_form">\n\t\t<h4>{{ id == null ? "New Server" : mutable_name }}</h4>\n\t\t<p id="maxB2shareUploadsPerUser">\n\t\t\t<input v-model="mutable_maxUploads"\n\t\t\t\ttitle="max_uploads"\n\t\t\t\ttype="text"\n\t\t\t\tname="max_uploads"\n\t\t\t\tplaceholder="5"\n\t\t\t\tstyle="width: 400px">\n\t\t\t<em># of uploads per user at the same time</em>\n\t\t</p>\n\t\t<p id="maxB2shareUploadSizePerFile">\n\t\t\t<input v-model="mutable_maxUploadFilesize"\n\t\t\t\ttitle="max_upload_filesize"\n\t\t\t\ttype="text"\n\t\t\t\tname="max_upload_filesize"\n\t\t\t\tplaceholder="512"\n\t\t\t\tstyle="width: 400px">\n\t\t\t<em>MB maximum filesize per upload</em>\n\t\t</p>\n\t\t<p>\n\t\t\t<input :id="getCheckboxName"\n\t\t\t\tv-model="mutable_checkSsl"\n\t\t\t\ttype="checkbox"\n\t\t\t\t:name="getCheckboxName"\n\t\t\t\tclass="checkbox"\n\t\t\t\t:checked="mutable_checkSsl"\n\t\t\t\tstyle="width: 400px">\n\t\t\t<label :for="getCheckboxName">Check SSL</label>\n\t\t</p>\n\t\t<p id="b2shareUrlField">\n\t\t\t<input v-model="mutable_publishUrl"\n\t\t\t\ttitle="publishurl"\n\t\t\t\ttype="text"\n\t\t\t\tname="publish_baseurl"\n\t\t\t\tplaceholder="https://b2share.eudat.eu"\n\t\t\t\tstyle="width: 400px">\n\t\t\t<em>Publish URL</em>\n\t\t</p>\n\t\t<p id="b2shareNameField">\n\t\t\t<input v-model="mutable_name"\n\t\t\t\ttitle="name"\n\t\t\t\ttype="text"\n\t\t\t\tname="name"\n\t\t\t\tstyle="width: 400px"\n\t\t\t\tplaceholder="Your Server Name">\n\t\t\t<em>Server name</em>\n\t\t</p>\n\t\t<button id="save" :disabled="!hasChanged()" @click="saveServer">\n\t\t\tSave\n\t\t</button>\n\t\t<button v-if="id !== null" @click="deleteServer">\n\t\t\tDelete\n\t\t</button>\n\t\t<button v-if="id === null"\n\t\t\tid="reset"\n\t\t\t:disabled="!hasChanged()"\n\t\t\t@click="resetProps">\n\t\t\tReset\n\t\t</button>\n\t</div>\n</template>\n\n<script>\nimport axios from \'@nextcloud/axios\'\nimport { generateUrl } from \'@nextcloud/router\'\n\nexport default {\n\tname: \'ServerEditor\',\n\tmodel: {\n\t\tevent: \'server-change\',\n\t},\n\tprops: {\n\t\tid: { default: null, type: Number },\n\t\tname: { required: false, type: String },\n\t\tpublishurl: { required: false, type: String },\n\t\tmaxuploads: { default: 5, type: Number },\n\t\tmaxuploadfilesize: { default: 512, type: Number },\n\t\tcheckssl: { default: false, type: Boolean },\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmutable_name: this.name,\n\t\t\tmutable_publishUrl: this.publishurl,\n\t\t\tmutable_maxUploads: this.maxuploads,\n\t\t\tmutable_maxUploadFilesize: this.maxuploadfilesize,\n\t\t\tmutable_checkSsl: this.checkssl,\n\t\t}\n\t},\n\tcomputed: {\n\t\tgetCheckboxName() {\n\t\t\treturn \'checkSsl\' + (this.id === null ? \'\' : this.id)\n\t\t},\n\t},\n\tmethods: {\n\t\tresetProps() {\n\t\t\tthis.mutable_name = null\n\t\t\tthis.mutable_publishUrl = null\n\t\t\tthis.mutable_maxUploads = 5\n\t\t\tthis.mutable_maxUploadFilesize = 512\n\t\t\tthis.mutable_checkSsl = false\n\t\t},\n\n\t\thasChanged() {\n\t\t\treturn this.mutable_name !== this.name\n          || this.mutable_publishUrl !== this.publishurl\n          || this.mutable_maxUploads !== this.maxuploads\n          || this.mutable_maxUploadFilesize !== this.maxuploadfilesize\n          || this.mutable_checkSsl !== this.checkssl\n\t\t},\n\n\t\tsaveServer() {\n\t\t\tconst data = {}\n\t\t\tif (this.id) {\n\t\t\t\tdata.id = this.id\n\t\t\t}\n\t\t\tdata.name = this.mutable_name\n\t\t\tdata.publishUrl = this.stripTrailingSlash(this.mutable_publishUrl)\n\t\t\tthis.mutable_publishUrl = data.publishUrl\n\t\t\tdata.maxUploads = this.mutable_maxUploads\n\t\t\tdata.maxUploadFilesize = this.mutable_maxUploadFilesize\n\t\t\tdata.checkSsl = this.mutable_checkSsl\n\t\t\tconsole.debug(JSON.stringify(data))\n\t\t\taxios.post(generateUrl(\'/apps/b2sharebridge/server\'), { server: data })\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.$emit(\'server-change\', this.id === null ? 0 : this.id)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(\'Could not save server\')\n\t\t\t\t\tconsole.debug(error)\n\t\t\t\t})\n\t\t},\n\n\t\tdeleteServer() {\n\t\t\tif (this.id) {\n\t\t\t\taxios.delete(generateUrl(\'/apps/b2sharebridge/servers/\' + this.id))\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconsole.log("Deleted server \'" + this.name + "\'")\n\t\t\t\t\t\tthis.$emit(\'server-change\', this.id)\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tconsole.error(\'Could not delete server\')\n\t\t\t\t\t\tconsole.debug(error)\n\t\t\t\t\t})\n\t\t\t}\n\t\t},\n\n\t\tstripTrailingSlash(str) {\n\t\t\treturn str.endsWith(\'/\')\n\t\t\t\t? str.slice(0, -1)\n\t\t\t\t: str\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\ndiv.server_form {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tmargin-top: 2px;\n}\n</style>\n'],sourceRoot:""}]);const i=l}},a={};function r(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={id:t,exports:{}};return s[t](n,n.exports,r),n.exports}r.m=s,e=[],r.O=(t,n,s,a)=>{if(!n){var l=1/0;for(u=0;u<e.length;u++){for(var[n,s,a]=e[u],i=!0,o=0;o<n.length;o++)(!1&a||l>=a)&&Object.keys(r.O).every((t=>r.O[t](n[o])))?n.splice(o--,1):(i=!1,a<l&&(l=a));if(i){e.splice(u--,1);var d=s();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,s,a]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={605:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var s,a,[l,i,o]=n,d=0;if(l.some((e=>0!==t[e]))){for(s in i)r.o(i,s)&&(r.m[s]=i[s]);if(o)var u=o(r)}for(e&&e(n);d<l.length;d++)a=l[d],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(u)},n=self.webpackChunkb2sharebridge=self.webpackChunkb2sharebridge||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),r.nc=void 0;var l=r.O(void 0,[218,320],(()=>r(9442)));l=r.O(l)})();
//# sourceMappingURL=b2sharebridge-settingsadmin.js.map?v=e0ddc1389d7f3380ebf7