(()=>{"use strict";var e,r={6852:(e,r,o)=>{var a=o(144),s=o(6256),i=o(8483),l=o(9652),d=o(9753),u=o(2954);o(281),o(4228),(0,u.l7)("tokenrule",{validate:t=>({required:!0,valid:60===t.length})}),(0,u.l7)("required",{validate:t=>({required:!0,valid:-1===["",null,void 0].indexOf(t)}),computesRequired:!0,message:t=>`Please enter a valid ${t}`}),(0,u.jQ)({classes:{valid:"is-valid",invalid:"is-invalid"},bails:!0,skipOptional:!0,mode:"aggressive",useConstraintAttrs:!0});const c={name:"TokenEditor",components:{ValidationObserver:u._j,ValidationProvider:u.d_},model:{event:"token-change"},props:{id:{required:!0,type:Number},name:{required:!0,type:String},url:{required:!0,type:String},token:{default:"",type:String}},data(){return{mutable_token:this.token}},methods:{saveToken(){const t={requesttoken:OC.requesttoken,token:this.mutable_token,serverid:this.id};l.Z.post((0,d.generateUrl)("/apps/b2sharebridge/apitoken"),t).then((t=>{console.info("Saved token!"),this.$emit("token-change",this.id)})).catch((t=>{console.error("Could not save token"),console.debug(t)}))},deleteToken(){l.Z.delete((0,d.generateUrl)("/apps/b2sharebridge/apitoken/"+this.id)).then((t=>{console.info("Deleted token!"),this.mutable_token="",this.$emit("token-change",this.id)})).catch((t=>{console.error("Could not delete token"),console.debug(t)}))},canSave(){return this.mutable_token!==this.token&&""!==this.mutable_token},getValidationState:({dirty:t,validated:e,valid:n=null})=>t||e?n:null}};var p=o(3379),v=o.n(p),b=o(7795),h=o.n(b),m=o(569),k=o.n(m),g=o(3565),A=o.n(g),f=o(9216),_=o.n(f),C=o(4589),x=o.n(C),T=o(9301),y={};y.styleTagTransform=x(),y.setAttributes=A(),y.insert=k().bind(null,"head"),y.domAPI=h(),y.insertStyleElement=_(),v()(T.Z,y),T.Z&&T.Z.locals&&T.Z.locals;var S=o(1900);const P={name:"PersonalSettings",components:{TokenEditor:(0,S.Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"token_form"},[e("h3",[t._v(t._s(t.name))]),t._v(" "),e("ValidationObserver",[e("b-form",{on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.saveToken.apply(null,arguments)}}},[e("p",{attrs:{id:"b2shareUrlField"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"publish_url",staticStyle:{width:"400px"},attrs:{title:"publish_baseurl",type:"text",disabled:""},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),t._v(" "),e("em",[t._v("External publishing")])]),t._v(" "),e("p",{attrs:{id:"b2shareAPITokenField"}},[e("ValidationProvider",{staticClass:"validation",attrs:{name:"token",rules:"required|tokenrule",vid:"prov_"+t.id},scopedSlots:t._u([{key:"default",fn:function(n){return[e("b-form-input",{staticClass:"form-control",staticStyle:{width:"400px","grid-column":"1"},attrs:{title:"b2share API token",type:"text",placeholder:"Your API token",name:"b2share_apitoken",state:t.getValidationState(n)},model:{value:t.mutable_token,callback:function(e){t.mutable_token=e},expression:"mutable_token"}}),t._v(" "),e("em",{staticClass:"validation"},[t._v("B2Share API token")]),t._v(" "),e("b-form-invalid-feedback",{staticStyle:{"grid-row":"2"},attrs:{id:"input-1-live-feedback"}},[t._v("\n\t\t\t\t\t\t"+t._s(n.errors[0])+"\n\t\t\t\t\t")])]}}])})],1),t._v(" "),e("p",{attrs:{id:"b2shareManageAPIToken"}},[e("button",{attrs:{type:"submit",disabled:!t.canSave()},on:{click:t.saveToken}},[t._v("\n\t\t\t\t\tSave B2SHARE API Token\n\t\t\t\t")]),t._v(" "),e("button",{attrs:{disabled:""===t.token},on:{click:t.deleteToken}},[t._v("\n\t\t\t\t\tDelete B2SHARE API Token\n\t\t\t\t")])])])],1)],1)}),[],!1,null,"4cd20c26",null).exports},data:()=>({servers:[],tokens:[],loaded:!1}),async mounted(){const t=this.loadServers();await this.loadTokens(),await t,this.loaded=!0},methods:{loadServers(){const t="/apps/b2sharebridge/servers?requesttoken="+encodeURIComponent(OC.requestToken);return l.Z.get((0,d.generateUrl)(t)).then((t=>{console.log("Loaded servers:"),console.debug(t),this.servers=t.data})).catch((t=>{console.error("Fetching B2SHARE servers failed!"),console.error(t)}))},loadTokens(){const t="/apps/b2sharebridge/apitoken?requesttoken="+encodeURIComponent(OC.requestToken);return l.Z.get((0,d.generateUrl)(t)).then((t=>{console.log("Loaded tokens:"),console.debug(t),this.tokens=t.data})).catch((t=>{console.error("Fetching B2SHARE tokens failed!"),console.error(t)}))},getToken(t){return this.tokens[t]||""},updateTokens(){this.loadTokens(),this.$forceUpdate()}}};var E=o(5344),O={};O.styleTagTransform=x(),O.setAttributes=A(),O.insert=k().bind(null,"head"),O.domAPI=h(),O.insertStyleElement=_(),v()(E.Z,O),E.Z&&E.Z.locals&&E.Z.locals;const q=(0,S.Z)(P,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"section",attrs:{id:"eudat_b2share"}},[e("h2",[t._v("EUDAT B2SHARE Bridge")]),t._v(" "),t.loaded&&t.servers.length?e("div",{staticClass:"servers"},[e("ul",t._l(t.servers,(function(n){return e("li",[e("TokenEditor",{attrs:{id:parseInt(n.id),name:n.name,url:n.publishUrl,token:t.getToken(n.id)},on:{"token-change":t.updateTokens}})],1)})),0)]):t._e(),t._v(" "),t.loaded&&0===t.servers.length?e("div",[e("p",[t._v("No B2SHARE servers configured! ")])]):t._e()])}),[],!1,null,"1927bc7e",null).exports;a.default.use(s.XG7),a.default.use(i.A7),a.default.extend(q),a.default.mixin({methods:{t,n}}),a.default.component("ValidationProvider",u.d_),a.default.component("ValidationObserver",u._j),document.getElementById("b2sharebridge-personal-settings")&&new a.default({el:"#b2sharebridge-personal-settings",render:t=>t(q)})},5344:(t,e,n)=>{n.d(e,{Z:()=>i});var r=n(7537),o=n.n(r),a=n(3645),s=n.n(a)()(o());s.push([t.id,"\ndiv.servers[data-v-1927bc7e] {\n\tmargin-top: 10px;\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\n","",{version:3,sources:["webpack://./src/components/PersonalSettings.vue"],names:[],mappings:";AA6FA;CACA,gBAAA;CACA,oCAAA;CACA,aAAA;CACA,mBAAA;AACA",sourcesContent:["<template>\n\t<div id=\"eudat_b2share\" class=\"section\">\n\t\t<h2>EUDAT B2SHARE Bridge</h2>\n\t\t<div v-if=\"loaded && servers.length\" class=\"servers\">\n\t\t\t<ul>\n\t\t\t\t<li v-for=\"server in servers\">\n\t\t\t\t\t<TokenEditor :id=\"parseInt(server.id)\"\n\t\t\t\t\t\t:name=\"server.name\"\n\t\t\t\t\t\t:url=\"server.publishUrl\"\n\t\t\t\t\t\t:token=\"getToken(server.id)\"\n\t\t\t\t\t\t@token-change=\"updateTokens\" />\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div v-if=\"loaded && servers.length === 0\">\n\t\t\t<p>No B2SHARE servers configured! </p>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport TokenEditor from './TokenEditor.vue'\n\nexport default {\n\tname: 'PersonalSettings',\n\tcomponents: {\n\t\tTokenEditor,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tservers: [],\n\t\t\ttokens: [],\n\t\t\tloaded: false,\n\t\t}\n\t},\n\n\t/**\n\t * Fetch list of servers when the component is loaded\n\t */\n\tasync mounted() {\n\t\tconst promise = this.loadServers()\n\t\tawait this.loadTokens() // ask for both and then wait\n\t\tawait promise\n\t\tthis.loaded = true\n\t},\n\tmethods: {\n\t\tloadServers() {\n\t\t\tconst url_path = '/apps/b2sharebridge/servers?requesttoken=' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(url_path))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.log('Loaded servers:')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.servers = response.data\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error('Fetching B2SHARE servers failed!')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\n\t\tloadTokens() {\n\t\t\tconst url_path = '/apps/b2sharebridge/apitoken?requesttoken=' + encodeURIComponent(OC.requestToken)\n\n\t\t\treturn axios\n\t\t\t\t.get(generateUrl(url_path))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.log('Loaded tokens:')\n\t\t\t\t\tconsole.debug(response)\n\t\t\t\t\tthis.tokens = response.data\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error('Fetching B2SHARE tokens failed!')\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t})\n\t\t},\n\n\t\tgetToken(server_id) {\n\t\t\treturn this.tokens[server_id] || ''\n\t\t},\n\n\t\tupdateTokens() {\n\t\t\tthis.loadTokens()\n\t\t\tthis.$forceUpdate()\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\ndiv.servers {\n\tmargin-top: 10px;\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n}\n</style>\n"],sourceRoot:""}]);const i=s},9301:(t,e,n)=>{n.d(e,{Z:()=>i});var r=n(7537),o=n.n(r),a=n(3645),s=n.n(a)()(o());s.push([t.id,"\ndiv.token_form[data-v-4cd20c26] {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tmargin-top: 2px;\n}\ninput.publish_url[data-v-4cd20c26] {\n\tbackground: rgba(128, 128, 128, 0.1);\n}\nem.validation[data-v-4cd20c26] {\n\talign-self: center;\n\tgrid-column: 2;\n}\nspan.validation[data-v-4cd20c26] {\n\tdisplay: grid;\n\tcolumn-gap: 7px;\n\tgrid-template-columns: 400px;\n}\n\n","",{version:3,sources:["webpack://./src/components/TokenEditor.vue"],names:[],mappings:";AA4JA;CACA,oCAAA;CACA,aAAA;CACA,mBAAA;CACA,eAAA;AACA;AAEA;CACA,oCAAA;AACA;AAEA;CACA,kBAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,eAAA;CACA,4BAAA;AACA",sourcesContent:['<template>\n\t<div class="token_form">\n\t\t<h3>{{ name }}</h3>\n\t\t<ValidationObserver>\n\t\t\t<b-form @submit.prevent.stop="saveToken">\n\t\t\t\t<p id="b2shareUrlField">\n\t\t\t\t\t<input v-model="url"\n\t\t\t\t\t\ttitle="publish_baseurl"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tstyle="width: 400px"\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tclass="publish_url">\n\t\t\t\t\t<em>External publishing</em>\n\t\t\t\t</p>\n\t\t\t\t<p id="b2shareAPITokenField">\n\t\t\t\t\t<ValidationProvider v-slot="validationContext"\n\t\t\t\t\t\tname="token"\n\t\t\t\t\t\trules="required|tokenrule"\n\t\t\t\t\t\t:vid="\'prov_\'+id"\n\t\t\t\t\t\tclass="validation">\n\t\t\t\t\t\t<b-form-input v-model="mutable_token"\n\t\t\t\t\t\t\ttitle="b2share API token"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tplaceholder="Your API token"\n\t\t\t\t\t\t\tname="b2share_apitoken"\n\t\t\t\t\t\t\tstyle="width: 400px; grid-column: 1"\n\t\t\t\t\t\t\tclass="form-control"\n\t\t\t\t\t\t\t:state="getValidationState(validationContext)" />\n\t\t\t\t\t\t<em class="validation">B2Share API token</em>\n\t\t\t\t\t\t<b-form-invalid-feedback id="input-1-live-feedback"\n\t\t\t\t\t\t\tstyle="grid-row: 2">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tvalidationContext.errors[0]\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</b-form-invalid-feedback>\n\t\t\t\t\t</ValidationProvider>\n\t\t\t\t</p>\n\t\t\t\t<p id="b2shareManageAPIToken">\n\t\t\t\t\t<button type="submit" :disabled="!canSave()" @click="saveToken">\n\t\t\t\t\t\tSave B2SHARE API Token\n\t\t\t\t\t</button>\n\t\t\t\t\t<button :disabled="token === \'\'" @click="deleteToken">\n\t\t\t\t\t\tDelete B2SHARE API Token\n\t\t\t\t\t</button>\n\t\t\t\t</p>\n\t\t\t</b-form>\n\t\t</ValidationObserver>\n\t</div>\n</template>\n\n<script>\nimport axios from \'@nextcloud/axios\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport { configure, extend, ValidationObserver, ValidationProvider } from \'vee-validate\'\n\nimport \'../../css/style.scss\'\nimport \'bootstrap-vue/dist/bootstrap-vue.css\'\n\nextend(\'tokenrule\', {\n\tvalidate(value) {\n\t\treturn {\n\t\t\trequired: true,\n\t\t\tvalid: value.length === 60,\n\t\t}\n\t},\n})\n\nextend(\'required\', {\n\tvalidate(value) {\n\t\treturn {\n\t\t\trequired: true,\n\t\t\tvalid: [\'\', null, undefined].indexOf(value) === -1,\n\t\t}\n\t},\n\tcomputesRequired: true,\n\tmessage: (fieldName) => {\n\t\treturn `Please enter a valid ${fieldName}`\n\t},\n})\n\nconst config = {\n\tclasses: {\n\t\tvalid: \'is-valid\',\n\t\tinvalid: \'is-invalid\',\n\t},\n\tbails: true,\n\tskipOptional: true,\n\tmode: \'aggressive\',\n\tuseConstraintAttrs: true,\n}\nconfigure(config)\n\nexport default {\n\tname: \'TokenEditor\',\n\tcomponents: {\n\t\tValidationObserver,\n\t\tValidationProvider,\n\t},\n\tmodel: {\n\t\tevent: \'token-change\',\n\t},\n\tprops: {\n\t\tid: { required: true, type: Number },\n\t\tname: { required: true, type: String },\n\t\turl: { required: true, type: String },\n\t\ttoken: { default: \'\', type: String },\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tmutable_token: this.token,\n\t\t}\n\t},\n\tmethods: {\n\t\tsaveToken() {\n\t\t\tconst data = {\n\t\t\t\trequesttoken: OC.requesttoken,\n\t\t\t\ttoken: this.mutable_token,\n\t\t\t\tserverid: this.id,\n\t\t\t}\n\t\t\taxios.post(generateUrl(\'/apps/b2sharebridge/apitoken\'), data)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.info(\'Saved token!\')\n\t\t\t\t\tthis.$emit(\'token-change\', this.id)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(\'Could not save token\')\n\t\t\t\t\tconsole.debug(error)\n\t\t\t\t})\n\t\t},\n\n\t\tdeleteToken() {\n\t\t\taxios.delete(generateUrl(\'/apps/b2sharebridge/apitoken/\' + this.id))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconsole.info(\'Deleted token!\')\n\t\t\t\t\tthis.mutable_token = \'\'\n\t\t\t\t\tthis.$emit(\'token-change\', this.id)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(\'Could not delete token\')\n\t\t\t\t\tconsole.debug(error)\n\t\t\t\t})\n\t\t},\n\n\t\tcanSave() {\n\t\t\treturn this.mutable_token !== this.token && this.mutable_token !== \'\'\n\t\t},\n\n\t\t// VeeValidate\n\t\tgetValidationState({ dirty, validated, valid = null }) {\n\t\t\treturn dirty || validated ? valid : null\n\t\t},\n\t},\n}\n<\/script>\n<style scoped>\n\ndiv.token_form {\n\tbackground: rgba(128, 128, 128, 0.1);\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tmargin-top: 2px;\n}\n\ninput.publish_url {\n\tbackground: rgba(128, 128, 128, 0.1);\n}\n\nem.validation {\n\talign-self: center;\n\tgrid-column: 2;\n}\n\nspan.validation {\n\tdisplay: grid;\n\tcolumn-gap: 7px;\n\tgrid-template-columns: 400px;\n}\n\n</style>\n'],sourceRoot:""}]);const i=s}},o={};function a(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={id:t,exports:{}};return r[t](n,n.exports,a),n.exports}a.m=r,e=[],a.O=(t,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,r,o]=e[u],i=!0,l=0;l<n.length;l++)(!1&o||s>=o)&&Object.keys(a.O).every((t=>a.O[t](n[l])))?n.splice(l--,1):(i=!1,o<s&&(s=o));if(i){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{a.b=document.baseURI||self.location.href;var t={503:0};a.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[s,i,l]=n,d=0;if(s.some((e=>0!==t[e]))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var u=l(a)}for(e&&e(n);d<s.length;d++)o=s[d],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(u)},n=self.webpackChunkb2sharebridge=self.webpackChunkb2sharebridge||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),a.nc=void 0;var s=a.O(void 0,[218,228,320,954,359],(()=>a(6852)));s=a.O(s)})();
//# sourceMappingURL=b2sharebridge-settingspersonal.js.map?v=bfd94f42f6140d4a6031